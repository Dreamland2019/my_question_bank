<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬å…‹æ€ä¸»ä¹‰åŸç†é¢˜åº“åˆ·é¢˜ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        header p {
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 20px;
        }

        .hidden {
            display: none !important;
        }
        
        .mode-selection {
            display: flex !important;
            flex-direction: column !important;
            gap: 15px !important;
        }
        
        .mode-btn {
            padding: 15px 25px !important;
            box-sizing: border-box !important;
            padding: 15px 25px !important;
            margin: 0 !important;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .sequential-btn {
            background-color: var(--primary-color);
            color: white;
        }
        
        .random-btn {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .mode-btn i {
            font-size: 1.3rem;
        }
        
        .question-container {
            display: none;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .question-type {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .single-choice {
            background-color: #e1f5fe;
            color: #0288d1;
        }
        
        .multiple-choice {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        
        .judgment {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .question-progress {
            font-size: 0.9rem;
            color: #666;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .options-container {
            margin-bottom: 25px;
        }
        
        .option {
            display: flex;
            align-items: flex-start;
            padding: 12px 15px;
            margin-bottom: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option:hover {
            background-color: #f9f9f9;
        }
        
        .option input {
            margin-right: 12px;
            margin-top: 3px;
        }
        
        .option.correct {
            background-color: rgba(46, 204, 113, 0.1);
            border-color: var(--success-color);
        }
        
        .option.incorrect {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: var(--error-color);
        }
        
        .option-label {
            font-weight: 600;
            margin-right: 8px;
        }
        
        .actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-direction: row; /* ç¡®ä¿æ°´å¹³æ’åˆ— */
            gap: 10px; /* æ·»åŠ æŒ‰é’®é—´è· */
        }

        /* è°ƒæ•´æŒ‰é’®å®½åº¦ï¼Œä½¿å…¶é€‚åˆæ°´å¹³å¸ƒå±€ */
        .actions .btn {
            flex: 1; /* è®©æŒ‰é’®å¹³å‡åˆ†é…å®½åº¦ */
            white-space: nowrap; /* é˜²æ­¢æŒ‰é’®æ–‡å­—æ¢è¡Œ */
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-secondary {
            background-color: #e0e0e0;
            color: #333;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .explanation-container {
            margin-top: 20px;
            border-top: 1px dashed #ddd;
            padding-top: 20px;
        }
        
        .explanation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .explanation-content {
            display: none;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .explanation-content.show {
            display: block;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            margin-bottom: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }
        
        .chapter-selector {
            margin-bottom: 20px;
            border-top: 1px dashed #ddd;
        }
        
        select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .bookmark-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #ccc;
            transition: color 0.2s;
        }
        
        .bookmark-btn.active {
            color: var(--warning-color);
        }
        
        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
        }

        .chapter-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            margin-top: 20px;
        }

        .chapter-selector-header h3 {
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .actions {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            /* åˆ›å»ºç¬¬äºŒè¡Œå®¹å™¨ */
            .second-row {
                display: flex;
                justify-content: space-between;
                gap: 10px;
            }
            
            /* ä¸Šä¸€é¢˜å’Œä¸‹ä¸€é¢˜æŒ‰é’®å¹³åˆ†ç¬¬äºŒè¡Œ */
            #prevBtn,
            #nextBtn {
                flex: 1;
            }

            .container {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
            
            .stats-container {
                flex-wrap: wrap;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .stat-item {
                flex: 1 0 45%;
            }

            /* æ¸…é™¤ç¼“å­˜æŒ‰é’®æ ·å¼ */
            .clear-cache-btn {
                background-color: var(--warning-color);
                color: white;
            }

            /* æ¨ªçº¿åˆ†éš”æ ·å¼ */
            .section-divider {
                height: 1px;
                background-color: #e0e0e0;
                margin: 20px 0;
                width: 100%;
                border-top: 1px dashed #ddd;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="home-btn" id="homeBtn">â†</button>
            <h1>HQUé©¬åŸé¢˜åº“åˆ·é¢˜ç³»ç»Ÿ</h1>
            <p>å‹‰å¼ºèƒ½ç”¨ï¼Œæ¬¢è¿åˆ†äº«ã€‚</p>
            <p>æœ€åæ›´æ–°ï¼š2025-10-12</p>
        </header>
        
        <div class="card mode-selection" id="modeSelection">
            <button class="mode-btn sequential-btn" id="sequentialBtn">
                <i>ğŸ“š</i> é¡ºåºåˆ·é¢˜
            </button>
            <button class="mode-btn random-btn" id="randomBtn">
                <i>ğŸ²</i> éšæœºåˆ·é¢˜
            </button>
            <button class="mode-btn clear-cache-btn" id="clearCacheBtn">
                <i>ğŸ—‘ï¸</i> æ¸…é™¤ç¼“å­˜
            </button>
        </div>
        
        <div class="card question-container" id="questionContainer">
            <div class="question-header">
                <div>
                    <span class="question-type" id="questionType">å•é€‰é¢˜</span>
                    <span class="question-progress" id="questionProgress">ç¬¬1ç« ï¼Œç¬¬1/20é¢˜</span>
                </div>
                <button class="bookmark-btn" id="bookmarkBtn">â˜†</button>
            </div>
            
            <div class="question-text" id="questionText">
                å½“äººç±»è¿ˆå…¥21ä¸–çºªçš„æ—¶å€™ï¼Œè‹±å›½ï¼¢ï¼¢ï¼£å¹¿æ’­å…¬å¸åœ¨å…¨çƒèŒƒå›´å†…ä¸¾è¡Œè¿‡ä¸€æ¬¡"åƒå¹´æ€æƒ³å®¶"ç½‘ä¸Šè¯„é€‰ã€‚ä½åˆ—æ¦œé¦–çš„æ˜¯
            </div>
            
            <div class="options-container" id="optionsContainer">
                <!-- é€‰é¡¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="actions">
                <button class="btn btn-primary" id="submitBtn">æäº¤ç­”æ¡ˆ</button>
                <div class="second-row">
                    <button class="btn btn-secondary" id="prevBtn">ä¸Šä¸€é¢˜</button>
                    <button class="btn btn-primary" id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
            
            <div class="explanation-container">
                <div class="explanation-header" id="explanationToggle">
                    <h3>ç­”æ¡ˆè§£æ</h3>
                    <span>â–¼</span>
                </div>
                <div class="explanation-content" id="explanationContent">
                    å½“äººç±»è¿ˆå…¥21ä¸–çºªçš„æ—¶å€™ï¼Œè‹±å›½ï¼¢ï¼¢ï¼£å¹¿æ’­å…¬å¸åœ¨å…¨çƒèŒƒå›´å†…ä¸¾è¡Œè¿‡ä¸€æ¬¡"åƒå¹´æ€æƒ³å®¶"ç½‘ä¸Šè¯„é€‰ã€‚ç»“æœé©¬å…‹æ€ä½åˆ—æ¦œé¦–ï¼Œååˆ—ç¬¬äºŒã€ç¬¬ä¸‰å’Œç¬¬å››çš„æ˜¯ç›¸å¯¹è®ºçš„åˆ›ç«‹è€…çˆ±å› æ–¯å¦ã€ä¸‡æœ‰å¼•åŠ›çš„å‘ç°è€…ç‰›é¡¿å’Œè¿›åŒ–è®ºçš„æå‡ºè€…è¾¾å°”æ–‡ã€‚
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">ç­”å¯¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="incorrectCount">0</div>
                    <div class="stat-label">ç­”é”™</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracyRate">0%</div>
                    <div class="stat-label">æ­£ç¡®ç‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="timeSpent">0:00</div>
                    <div class="stat-label">ç”¨æ—¶</div>
                </div>
            </div>
            
            <div class="chapter-selector" id="chapterSelector" style="display: none;">
                <div class="chapter-selector-header">
                    <h3>ç« èŠ‚é€‰æ‹©</h3>
                </div>
                <select id="chapterSelect">
                    <!-- ç« èŠ‚é€‰é¡¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let questions = [];
        let currentQuestionIndex = 0;
        let currentMode = '';
        let userAnswers = [];
        let startTime;
        let timerInterval;
        let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];
        
        // DOMå…ƒç´ 
        const modeSelection = document.getElementById('modeSelection');
        const questionContainer = document.getElementById('questionContainer');
        const homeBtn = document.getElementById('homeBtn');
        const sequentialBtn = document.getElementById('sequentialBtn');
        const randomBtn = document.getElementById('randomBtn');
        const questionType = document.getElementById('questionType');
        const questionProgress = document.getElementById('questionProgress');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const prevBtn = document.getElementById('prevBtn');
        const submitBtn = document.getElementById('submitBtn');
        const nextBtn = document.getElementById('nextBtn');
        const explanationToggle = document.getElementById('explanationToggle');
        const explanationContent = document.getElementById('explanationContent');
        const correctCount = document.getElementById('correctCount');
        const incorrectCount = document.getElementById('incorrectCount');
        const accuracyRate = document.getElementById('accuracyRate');
        const timeSpent = document.getElementById('timeSpent');
        const chapterSelector = document.getElementById('chapterSelector');
        const chapterSelect = document.getElementById('chapterSelect');
        const bookmarkBtn = document.getElementById('bookmarkBtn');
        const totalQuestions = document.getElementById('totalQuestions');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½é¢˜ç›®æ•°æ®
            fetch('question_bank.json')
                .then(response => response.json())
                .then(data => {
                    questions = data.questions;
                    totalQuestions.textContent = data.metadata.total_questions;
                    initializeChapterSelect(data.chapters);
                })
                .catch(error => {
                    console.error('åŠ è½½é¢˜ç›®æ•°æ®å¤±è´¥:', error);
                    alert('åŠ è½½é¢˜ç›®æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥question_bank.jsonæ–‡ä»¶æ˜¯å¦å­˜åœ¨');
                });
            
            // äº‹ä»¶ç›‘å¬
            sequentialBtn.addEventListener('click', () => startPractice('sequential'));
            randomBtn.addEventListener('click', () => startPractice('random'));
            homeBtn.addEventListener('click', goHome);
            submitBtn.addEventListener('click', submitAnswer);
            nextBtn.addEventListener('click', nextQuestion);
            prevBtn.addEventListener('click', prevQuestion);
            explanationToggle.addEventListener('click', toggleExplanation);
            chapterSelect.addEventListener('change', changeChapter);
            bookmarkBtn.addEventListener('click', toggleBookmark);
            clearCacheBtn.addEventListener('click', clearCache);
            
            // åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯
            loadStats();
        });

        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®å—ï¼Ÿè¿™å°†é‡ç½®æ‚¨çš„ç­”é¢˜ç»Ÿè®¡ã€ä¹¦ç­¾å’Œè®¡æ—¶ä¿¡æ¯ã€‚')) {
                // æ¸…é™¤localStorageä¸­çš„æ‰€æœ‰æ•°æ®
                localStorage.removeItem('stats');
                localStorage.removeItem('bookmarks');
                
                // é‡ç½®å†…å­˜ä¸­çš„å˜é‡
                bookmarks = [];
                
                // é‡ç½®ç»Ÿè®¡æ˜¾ç¤º
                const stats = {
                    correct: 0,
                    incorrect: 0,
                    total: 0
                };
                displayStats(stats);
                
                alert('ç¼“å­˜å·²æ¸…é™¤ï¼');
            }
        }
        
        // å¼€å§‹ç»ƒä¹ 
        function startPractice(mode) {
            currentMode = mode;
            userAnswers = [];
            
            // ä½¿ç”¨style.displayæ§åˆ¶æ˜¾ç¤º/éšè—
            modeSelection.style.display = 'none';
            questionContainer.style.display = 'block';
            homeBtn.style.display = 'block';
            
            // æ ¹æ®æ¨¡å¼æ˜¾ç¤ºç« èŠ‚é€‰æ‹©å™¨
            if (mode === 'sequential') {
                chapterSelector.style.display = 'block';
                
                // é‡ç½®åˆ°ç¬¬ä¸€ç« ç¬¬ä¸€é¢˜
                currentQuestionIndex = 0;
                
                // é‡ç½®ç« èŠ‚é€‰æ‹©å™¨åˆ°ç¬¬ä¸€ç« 
                if (chapterSelect.options.length > 0) {
                    chapterSelect.value = "1.1";
                }
                
                // ç¡®ä¿é¢˜ç›®æ•°ç»„æ˜¯åŸå§‹é¡ºåº
                restoreOriginalOrder();
            } else {
                chapterSelector.style.display = 'none';
                
                // éšæœºæ¨¡å¼ä¸‹æ‰“ä¹±é¢˜ç›®
                shuffleQuestions();
                currentQuestionIndex = 0;
            }
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
            
            // æ˜¾ç¤ºç¬¬ä¸€é¢˜
            displayQuestion();
        }
        
        function restoreOriginalOrder() {
            // é‡æ–°åŠ è½½é¢˜ç›®æ•°æ®ï¼Œç¡®ä¿æ˜¯åŸå§‹é¡ºåº
            fetch('question_bank.json')
                .then(response => response.json())
                .then(data => {
                    questions = data.questions;
                    displayQuestion(); // é‡æ–°æ˜¾ç¤ºé¢˜ç›®
                })
                .catch(error => {
                    console.error('é‡æ–°åŠ è½½é¢˜ç›®æ•°æ®å¤±è´¥:', error);
                });
        }
        
        // è¿”å›é¦–é¡µ
        function goHome() {
            // ä½¿ç”¨style.displayæ§åˆ¶æ˜¾ç¤º/éšè—
            modeSelection.style.display = 'block';
            questionContainer.style.display = 'none';
            homeBtn.style.display = 'none';
            
            // åœæ­¢è®¡æ—¶
            clearInterval(timerInterval);
            
            // ä¿å­˜ç»Ÿè®¡ä¿¡æ¯
            saveStats();
            
            // å¼ºåˆ¶é‡æ’ä»¥ä¿®å¤æŒ‰é’®å¸ƒå±€é—®é¢˜
            void modeSelection.offsetHeight;
        }
        
        // æ˜¾ç¤ºé¢˜ç›®
        function displayQuestion() {
            if (questions.length === 0) return;
            
            const question = questions[currentQuestionIndex];
            
            // ç¡®ä¿questionå¯¹è±¡å­˜åœ¨ä¸”åŒ…å«å¿…è¦çš„å±æ€§
            if (!question || !question.options) {
                console.error("é¢˜ç›®æ•°æ®ä¸å®Œæ•´:", question);
                // å¦‚æœå½“å‰é¢˜ç›®æœ‰é—®é¢˜ï¼Œå°è¯•åŠ è½½ä¸‹ä¸€é¢˜
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    setTimeout(displayQuestion, 0); // ä½¿ç”¨setTimeouté¿å…é€’å½’è¿‡æ·±
                } else {
                    alert("é¢˜ç›®æ•°æ®åŠ è½½å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");
                }
                return;
            }
            
            // æ›´æ–°é¢˜ç›®ç±»å‹
            questionType.textContent = question.type;
            questionType.className = 'question-type';
            
            if (question.type === 'å•é€‰é¢˜') {
                questionType.classList.add('single-choice');
            } else if (question.type === 'å¤šé€‰é¢˜') {
                questionType.classList.add('multiple-choice');
            } else if (question.type === 'åˆ¤æ–­é¢˜') {
                questionType.classList.add('judgment');
            }
            
            // æ›´æ–°è¿›åº¦ä¿¡æ¯
            if (currentMode === 'sequential') {
                const chapter = question.chapter;
                const chapterQuestions = questions.filter(q => q.chapter === chapter);
                const indexInChapter = chapterQuestions.findIndex(q => q.id === question.id);
                questionProgress.textContent = `ç¬¬${chapter}ç« ï¼Œç¬¬${indexInChapter + 1}/${chapterQuestions.length}é¢˜`;
            } else {
                questionProgress.textContent = `éšæœºæ¨¡å¼ï¼Œç¬¬${currentQuestionIndex + 1}/${questions.length}é¢˜`;
            }
            
            // æ›´æ–°é¢˜ç›®æ–‡æœ¬
            questionText.textContent = question.question;
            
            // æ›´æ–°é€‰é¡¹ - ç¡®ä¿é€‰é¡¹å®¹å™¨å®Œå…¨æ¸…ç©º
            optionsContainer.innerHTML = '';
            const options = question.options;
            
            // æ£€æŸ¥é€‰é¡¹æ˜¯å¦ä¸ºç©º
            if (!options || Object.keys(options).length === 0) {
                console.error("é¢˜ç›®é€‰é¡¹ä¸ºç©º:", question);
                optionsContainer.innerHTML = '<div class="option error">é¢˜ç›®é€‰é¡¹æ•°æ®å¼‚å¸¸</div>';
            } else {
                for (const key in options) {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    
                    const input = document.createElement('input');
                    input.type = question.type === 'å¤šé€‰é¢˜' ? 'checkbox' : 'radio';
                    input.name = 'answer';
                    input.value = key;
                    input.id = `option-${key}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `option-${key}`;
                    label.innerHTML = `<span class="option-label">${key}.</span> ${options[key]}`;
                    
                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    optionsContainer.appendChild(optionDiv);
                    
                    // æ·»åŠ é€‰é¡¹ç‚¹å‡»äº‹ä»¶
                    optionDiv.addEventListener('click', function() {
                        if (question.type === 'å¤šé€‰é¢˜') {
                            input.checked = !input.checked;
                        } else {
                            // å•é€‰æˆ–åˆ¤æ–­ï¼Œå…ˆå–æ¶ˆæ‰€æœ‰é€‰æ‹©
                            document.querySelectorAll('input[name="answer"]').forEach(radio => {
                                radio.checked = false;
                            });
                            input.checked = true;
                        }
                    });
                }
            }
            
            // æ›´æ–°ç­”æ¡ˆè§£æå†…å®¹
            explanationContent.textContent = question.explanation || 'æš‚æ— è§£æ';
            
            // æ›´æ–°ä¹¦ç­¾çŠ¶æ€
            updateBookmarkButton();
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            submitBtn.disabled = false;
            nextBtn.disabled = true;
            prevBtn.disabled = currentQuestionIndex === 0;
            
            // éšè—è§£æ
            explanationContent.classList.remove('show');
        }
        
        // æäº¤ç­”æ¡ˆ
        function submitAnswer() {
            const question = questions[currentQuestionIndex];
            const selectedOptions = Array.from(document.querySelectorAll('input[name="answer"]:checked'))
                .map(input => input.value);
            
            if (selectedOptions.length === 0) {
                alert('è¯·é€‰æ‹©ç­”æ¡ˆ');
                return;
            }
            
            // ç¦ç”¨æäº¤æŒ‰é’®
            submitBtn.disabled = true;
            
            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆå’Œé”™è¯¯ç­”æ¡ˆ
            const correctAnswers = question.correct_answer.split('');
            
            document.querySelectorAll('.option').forEach(option => {
                const input = option.querySelector('input');
                const optionValue = input.value;
                
                if (correctAnswers.includes(optionValue)) {
                    option.classList.add('correct');
                } else if (selectedOptions.includes(optionValue) && !correctAnswers.includes(optionValue)) {
                    option.classList.add('incorrect');
                }
            });
            
            // è®°å½•ç”¨æˆ·ç­”æ¡ˆ
            userAnswers.push({
                questionId: question.id,
                userAnswer: selectedOptions.join(''),
                correctAnswer: question.correct_answer,
                isCorrect: arraysEqual(selectedOptions.sort(), correctAnswers.sort())
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats(userAnswers[userAnswers.length - 1].isCorrect);
            
            // å¦‚æœç­”é”™ï¼Œè‡ªåŠ¨å±•å¼€è§£æ
            if (!userAnswers[userAnswers.length - 1].isCorrect) {
                explanationContent.classList.add('show');
            }
            
            // å¯ç”¨ä¸‹ä¸€é¢˜æŒ‰é’®
            nextBtn.disabled = false;
        }
        
        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                alert('å·²ç»æ˜¯æœ€åä¸€é¢˜äº†ï¼');
            }
        }
        
        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }
        
        // åˆ‡æ¢è§£ææ˜¾ç¤º
        function toggleExplanation() {
            explanationContent.classList.toggle('show');
        }
        
        // åˆ‡æ¢ç« èŠ‚
        function changeChapter() {
            const selectedChapter = chapterSelect.value;
            const chapterQuestions = questions.filter(q => q.chapter === selectedChapter);
            
            if (chapterQuestions.length > 0) {
                // æ‰¾åˆ°è¯¥ç« èŠ‚ç¬¬ä¸€é¢˜åœ¨å®Œæ•´é¢˜ç›®åˆ—è¡¨ä¸­çš„ç´¢å¼•
                currentQuestionIndex = questions.findIndex(q => q.id === chapterQuestions[0].id);
                displayQuestion();
            }
        }
        
        // åˆ‡æ¢ä¹¦ç­¾
        function toggleBookmark() {
            const questionId = questions[currentQuestionIndex].id;
            const index = bookmarks.indexOf(questionId);
            
            if (index === -1) {
                bookmarks.push(questionId);
            } else {
                bookmarks.splice(index, 1);
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            updateBookmarkButton();
        }
        
        // æ›´æ–°ä¹¦ç­¾æŒ‰é’®çŠ¶æ€
        function updateBookmarkButton() {
            const questionId = questions[currentQuestionIndex].id;
            bookmarkBtn.classList.toggle('active', bookmarks.includes(questionId));
        }
        
        // åˆå§‹åŒ–ç« èŠ‚é€‰æ‹©å™¨
        function initializeChapterSelect(chapters) {
            chapterSelect.innerHTML = '';
            
            for (const chapter in chapters) {
                const option = document.createElement('option');
                option.value = chapter;
                option.textContent = `ç¬¬${chapter}ç«  ${chapters[chapter]}`;
                chapterSelect.appendChild(option);
            }
        }
        
        // éšæœºæ‰“ä¹±é¢˜ç›®
        function shuffleQuestions() {
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
        }
        
        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(() => {
                const now = new Date();
                const diff = Math.floor((now - startTime) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpent.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }, 1000);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(isCorrect) {
            const stats = JSON.parse(localStorage.getItem('stats')) || {
                correct: 0,
                incorrect: 0,
                total: 0
            };
            
            if (isCorrect) {
                stats.correct++;
            } else {
                stats.incorrect++;
            }
            
            stats.total++;
            
            localStorage.setItem('stats', JSON.stringify(stats));
            displayStats(stats);
        }
        
        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function displayStats(stats) {
            correctCount.textContent = stats.correct;
            incorrectCount.textContent = stats.incorrect;
            accuracyRate.textContent = stats.total > 0 ? 
                `${Math.round((stats.correct / stats.total) * 100)}%` : '0%';
        }
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        function loadStats() {
            const stats = JSON.parse(localStorage.getItem('stats')) || {
                correct: 0,
                incorrect: 0,
                total: 0
            };
            displayStats(stats);
        }
        
        // ä¿å­˜ç»Ÿè®¡ä¿¡æ¯
        function saveStats() {
            // ç»Ÿè®¡ä¿¡æ¯å·²å®æ—¶æ›´æ–°ï¼Œæ— éœ€é¢å¤–ä¿å­˜
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ¯”è¾ƒä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰
        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) return false;
            for (let i = 0; i < arr1.length; i++) {
                if (arr1[i] !== arr2[i]) return false;
            }
            return true;
        }
    </script>
</body>
</html>
